# ğŸ—ï¸ Backend Architecture

ë°±ì—”ë“œ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ ë° ì„¤ê³„ ë¬¸ì„œì…ë‹ˆë‹¤.

---

## ğŸ“ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       CLIENT LAYER                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Web Browser   â”‚  Samsung App    â”‚   Apple App     â”‚
â”‚   (React)       â”‚  (React Native) â”‚   (Swift)       â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                 â”‚                 â”‚
         â”‚    HTTP/REST    â”‚                 â”‚
         â–¼                 â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           FASTAPI APPLICATION                            â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                         API LAYER (Routers)                        â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚file_upload_  â”‚ â”‚auto_upload_  â”‚ â”‚  chat_api    â”‚ â”‚ user_api   â”‚ â”‚  â”‚
â”‚  â”‚  â”‚api.py        â”‚ â”‚api.py        â”‚ â”‚              â”‚ â”‚            â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚         â”‚                â”‚                â”‚               â”‚        â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚        â”‚  â”‚
â”‚  â”‚  â”‚similar_api   â”‚ â”‚vectordb_     â”‚                        â”‚        â”‚  â”‚
â”‚  â”‚  â”‚              â”‚ â”‚router        â”‚                        â”‚        â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚            â”‚                â”‚                                â”‚           â”‚
â”‚            â–¼                â–¼                                â–¼           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                       SERVICE LAYER                                 â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚file_upload_  â”‚ â”‚auto_upload_  â”‚ â”‚chat_service  â”‚ â”‚similar_    â”‚ â”‚  â”‚
â”‚  â”‚  â”‚service.py    â”‚ â”‚service.py    â”‚ â”‚              â”‚ â”‚service.py  â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚            â”‚                â”‚                â”‚               â”‚           â”‚
â”‚            â–¼                â–¼                â–¼               â–¼           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                         CORE LAYER                                 â”‚  â”‚
â”‚  â”‚                                                                    â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚                    CHATBOT ENGINE                           â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â”‚chat_       â”‚ â”‚fixed_      â”‚ â”‚intent_     â”‚ â”‚persona   â”‚  â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â”‚generator   â”‚ â”‚responses   â”‚ â”‚classifier  â”‚ â”‚          â”‚  â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                             â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â”‚rag_query   â”‚                                             â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                             â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â”‚                                                                    â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚health_     â”‚ â”‚llm_        â”‚ â”‚vector_     â”‚ â”‚rag_query       â”‚   â”‚  â”‚
â”‚  â”‚  â”‚interpreter â”‚ â”‚analysis    â”‚ â”‚store       â”‚ â”‚(core)          â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â”‚                                                                    â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚db_parser   â”‚ â”‚db_to_json  â”‚ â”‚unzipper    â”‚ â”‚adaptive_       â”‚   â”‚  â”‚
â”‚  â”‚  â”‚            â”‚ â”‚            â”‚ â”‚            â”‚ â”‚threshold       â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                    â”‚                                     â”‚
â”‚                                    â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                        UTILS LAYER                                 â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚preprocess  â”‚ â”‚preprocess_for_     â”‚ â”‚platform_detection     â”‚   â”‚  â”‚
â”‚  â”‚  â”‚            â”‚ â”‚embedding           â”‚ â”‚                       â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          EXTERNAL SERVICES                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚     ChromaDB       â”‚           â”‚         OpenAI API                 â”‚ â”‚
â”‚  â”‚  (Vector Store)    â”‚           â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚                    â”‚           â”‚  â”‚Embeddings  â”‚ â”‚Chat Completionsâ”‚ â”‚ â”‚
â”‚  â”‚  ./chroma_data/    â”‚           â”‚  â”‚(text-emb-  â”‚ â”‚(gpt-4o-mini)   â”‚ â”‚ â”‚
â”‚  â”‚                    â”‚           â”‚  â”‚3-small)    â”‚ â”‚                â”‚ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”· ë ˆì´ì–´ êµ¬ì¡°

### Layer 1: API Layer (Routers)

**ì—­í• **: HTTP ìš”ì²­ ìˆ˜ì‹ , ì…ë ¥ ê²€ì¦, ì‘ë‹µ ë°˜í™˜

```
app/api/
â”œâ”€â”€ file_upload_api.py   # ZIP/DB íŒŒì¼ ì—…ë¡œë“œ
â”œâ”€â”€ auto_upload_api.py   # ì•± JSON ì—…ë¡œë“œ
â”œâ”€â”€ chat_api.py          # ì±—ë´‡ (ììœ í˜•/ê³ ì •í˜•)
â”œâ”€â”€ user_api.py          # ì‚¬ìš©ì ë¶„ì„
â””â”€â”€ similar_api.py       # ìœ ì‚¬ë„ ê²€ìƒ‰
```

**íŠ¹ì§•**:

- Pydantic ëª¨ë¸ë¡œ ì…ë ¥ ê²€ì¦
- FastAPI Routerë¡œ ì—”ë“œí¬ì¸íŠ¸ ë¶„ë¦¬
- ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì€ Service ë ˆì´ì–´ì— ìœ„ì„

### Layer 2: Service Layer

**ì—­í• **: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì¡°í•©, íŠ¸ëœì­ì…˜ ê´€ë¦¬

```
app/service/
â”œâ”€â”€ file_upload_service.py   # ZIP ì²˜ë¦¬ ì „ì²´ íë¦„
â”œâ”€â”€ auto_upload_service.py   # API ì—…ë¡œë“œ ì „ì²´ íë¦„
â”œâ”€â”€ chat_service.py          # ì±—ë´‡ ì„œë¹„ìŠ¤
â””â”€â”€ similar_service.py       # ìœ ì‚¬ë„ ê²€ìƒ‰ ì„œë¹„ìŠ¤
```

**íŠ¹ì§•**:

- Core ëª¨ë“ˆë“¤ì„ ì¡°í•©
- ë¹„ë™ê¸° ì²˜ë¦¬ (ThreadPoolExecutor)
- ì—ëŸ¬ í•¸ë“¤ë§ ë° ë¡œê¹…

### Layer 3: Core Layer

**ì—­í• **: í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§, ì•Œê³ ë¦¬ì¦˜

```
app/core/
â”œâ”€â”€ health_interpreter.py   # ê·œì¹™ ê¸°ë°˜ ê±´ê°• í•´ì„
â”œâ”€â”€ llm_analysis.py         # LLM ë¶„ì„ ì—”ì§„
â”œâ”€â”€ vector_store.py         # VectorDB ê´€ë¦¬
â”œâ”€â”€ rag_query.py            # RAG ì¿¼ë¦¬ ë¹Œë”
â”œâ”€â”€ db_parser.py            # Samsung DB íŒŒì„œ
â”œâ”€â”€ db_to_json.py           # SQLite ë³€í™˜
â”œâ”€â”€ unzipper.py             # ZIP í•´ì œ
â”œâ”€â”€ adaptive_threshold.py   # ì ì‘í˜• ì„ê³„ê°’
â”‚
â””â”€â”€ chatbot_engine/         # ì±—ë´‡ ì „ìš© ëª¨ë“ˆ
    â”œâ”€â”€ chat_generator.py   # ììœ í˜• ì‘ë‹µ ìƒì„±
    â”œâ”€â”€ fixed_responses.py  # ê³ ì •í˜• ì‘ë‹µ ìƒì„±
    â”œâ”€â”€ intent_classifier.py # ì˜ë„ ë¶„ë¥˜
    â”œâ”€â”€ persona.py          # ìºë¦­í„° í˜ë¥´ì†Œë‚˜
    â””â”€â”€ rag_query.py        # ì±—ë´‡ìš© RAG
```

### Layer 4: Utils Layer

**ì—­í• **: ê³µí†µ ìœ í‹¸ë¦¬í‹°, ë°ì´í„° ë³€í™˜

```
app/utils/
â”œâ”€â”€ preprocess.py              # ê±´ê°• ë°ì´í„° ì „ì²˜ë¦¬
â”œâ”€â”€ preprocess_for_embedding.py # ì„ë² ë”©ìš© í…ìŠ¤íŠ¸ ìƒì„±
â””â”€â”€ platform_detection.py      # í”Œë«í¼ ê°ì§€
```

---

## ğŸ“¡ API ì—”ë“œí¬ì¸íŠ¸ ë§µ

### ë°ì´í„° ì—…ë¡œë“œ

| ì—”ë“œí¬ì¸íŠ¸         | ë©”ì„œë“œ | Input                                                  | Output                                        |
| ------------------ | ------ | ------------------------------------------------------ | --------------------------------------------- |
| `/api/file/upload` | POST   | multipart (file, user_id, difficulty, duration)        | { summary, llm_result, total_days_saved }     |
| `/api/auto/upload` | POST   | JSON { user_id, date, raw_json, difficulty, duration } | { summary, analysis, ai_recommended_routine } |

### ë¶„ì„

| ì—”ë“œí¬ì¸íŠ¸                  | ë©”ì„œë“œ | Input                                   | Output                                        |
| --------------------------- | ------ | --------------------------------------- | --------------------------------------------- |
| `/api/user/latest-analysis` | GET    | Query { user_id, difficulty, duration } | { summary, analysis, ai_recommended_routine } |
| `/api/user/raw-history`     | GET    | Query { user_id }                       | { data: [...] }                               |

### ì±—ë´‡

| ì—”ë“œí¬ì¸íŠ¸        | ë©”ì„œë“œ | Input                                      | Output                  |
| ----------------- | ------ | ------------------------------------------ | ----------------------- |
| `/api/chat`       | POST   | JSON { user_id, message, character }       | { character, response } |
| `/api/chat/fixed` | POST   | JSON { user_id, question_type, character } | { character, response } |

### VectorDB ê´€ë¦¬

| ì—”ë“œí¬ì¸íŠ¸                     | ë©”ì„œë“œ | Input            | Output                 |
| ------------------------------ | ------ | ---------------- | ---------------------- |
| `/api/vectordb/status`         | GET    | None             | { total_count, users } |
| `/api/vectordb/user/{user_id}` | GET    | Path { user_id } | { count, data }        |

### ìœ ì‚¬ë„ ê²€ìƒ‰

| ì—”ë“œí¬ì¸íŠ¸     | ë©”ì„œë“œ | Input                     | Output      |
| -------------- | ------ | ------------------------- | ----------- |
| `/api/similar` | POST   | JSON { summary, user_id } | { results } |

---

## ğŸ”„ ì„œë¹„ìŠ¤ ê°„ ìƒí˜¸ì‘ìš©

### 1. ë°ì´í„° ì—…ë¡œë“œ í”Œë¡œìš°

```
[ZIP Upload Flow]

file_upload_api.py
       â”‚
       â–¼
file_upload_service.py
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â–¼              â–¼              â–¼              â–¼
  unzipper.py   db_to_json.py   db_parser.py   preprocess.py
       â”‚              â”‚              â”‚              â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    vector_store.py â—„â”€â”€â”€â”€â–º ChromaDB
                             â”‚
                             â–¼
                    llm_analysis.py â—„â”€â”€â”€â”€â–º OpenAI API
                             â”‚
                             â–¼
                health_interpreter.py
```

[API Upload Flow]

auto_upload_api.py
â”‚
â–¼
auto_upload_service.py
â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â–¼ â–¼ â–¼ â–¼
preprocess.py vector_store.py llm_analysis.py platform_detection
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”‚
â–¼ â–¼ â–¼ â”‚
normalize save_daily run_llm "samsung"
\_raw \_summary \_analysis or "apple"
â”‚ â”‚ â”‚ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â–¼
VectorDB (ChromaDB)
source: "api_samsung" or "api_apple"

### 2. ë¶„ì„ í”Œë¡œìš°

```
[Analysis Flow]

user_api.py
       â”‚
       â–¼
vector_store.py â—„â”€â”€â”€â”€â–º ChromaDB
       â”‚
       â–¼
llm_analysis.py
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â–¼                                              â–¼
health_interpreter.py                         vector_store.py
       â”‚                                      (RAG ê²€ìƒ‰)
       â”‚                                              â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€ [Fallback ì¡°ê±´] â”€â”€â–º get_fallback_routine()
       â”‚
       â””â”€â”€â”€ [LLM í˜¸ì¶œ] â”€â”€â–º OpenAI API â”€â”€â–º validate_routine()
```

### 3. ì±—ë´‡ í”Œë¡œìš°

```
[ììœ í˜• Chat Flow]

chat_api.py
       â”‚
       â–¼
chat_service.py â†’ handle_chat()
       â”‚
       â–¼
chat_generator.py â†’ generate()
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â–¼                                         â–¼
intent_classifier.py                     persona.py
       â”‚                                         â”‚
       â–¼                                         â”‚
  â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”                                    â”‚
  â”‚         â”‚                                    â”‚
  â–¼         â–¼                                    â”‚
health   routine                                 â”‚
query    request                                 â”‚
  â”‚         â”‚                                    â”‚
  â–¼         â–¼                                    â”‚
rag_query.py                                     â”‚
  â”‚                                              â”‚
  â–¼                                              â”‚
vector_store.py â—„â”€â”€â”€â”€â–º ChromaDB                  â”‚
  â”‚                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
                   OpenAI API
                   (ì‘ë‹µ ìƒì„±)
```

```
[ê³ ì •í˜• Chat Flow]

chat_api.py
       â”‚
       â–¼
chat_service.py â†’ handle_fixed_chat()
       â”‚
       â–¼
fixed_responses.py â†’ generate_fixed_response()
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â–¼                                         â–¼
vector_store.py                          persona.py
(ìµœê·¼ 5ì¼ ì¡°íšŒ)                                  â”‚
       â”‚                                         â”‚
       â–¼                                         â”‚
health_interpreter.py                            â”‚
       â”‚                                         â”‚
       â–¼                                         â”‚
  â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚ question_typeë³„ ë¶„ê¸°                    â”‚    â”‚
  â”œâ”€ weekly_report    â†’ LLM í˜¸ì¶œ           â”‚    â”‚
  â”œâ”€ today_recommendation â†’ run_llm_analysisâ”‚    â”‚
  â”œâ”€ weekly_steps     â†’ LLM í˜¸ì¶œ           â”‚    â”‚
  â”œâ”€ sleep_report     â†’ LLM í˜¸ì¶œ           â”‚    â”‚
  â”œâ”€ heart_rate       â†’ LLM í˜¸ì¶œ           â”‚    â”‚
  â””â”€ health_score     â†’ LLM í˜¸ì¶œ           â”‚    â”‚
       â”‚                                         â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    ìºë¦­í„° í…œí”Œë¦¿ ì ìš©
                             â”‚
                             â–¼
                        ì‘ë‹µ ë°˜í™˜
```

---

## ğŸ—„ï¸ ë°ì´í„° ì €ì¥ì†Œ

### ChromaDB (Vector Store)

```
./chroma_data/
â””â”€â”€ health_summaries/     # Collection
    â”œâ”€â”€ embeddings        # OpenAI text-embedding-3-small
    â”œâ”€â”€ documents         # Natural language summaries
    â””â”€â”€ metadatas         # user_id, date, source, health_score, ...
```

**Document ID í˜•ì‹**:

```python
doc_id = f"{user_id}_{date}_{source}"
# ì˜ˆ: "user@email.com_2025-12-17_api_samsung"
```

**Metadata êµ¬ì¡°**:

```python
{
    "user_id": "user@email.com",
    "date": "2025-12-17",
    "timestamp": 20251217,
    "health_score": 75,
    "recommended_intensity": "ì¤‘",
    "source": "api_samsung",
    "platform": "samsung",
    "updated_at": "20251217143000",
    "summary_json": "{...}"
}
```

---

## âš™ï¸ ì„¤ì • ê´€ë¦¬

### config.py

```python
# LLM ì„¤ì •
LLM_MODEL_MAIN = os.getenv("LLM_MODEL", "gpt-4o-mini")
LLM_TEMPERATURE = float(os.getenv("LLM_TEMPERATURE", "0.3"))
LLM_MAX_TOKENS = int(os.getenv("LLM_MAX_TOKENS", "2048"))

# ê¸°ë³¸ê°’
DEFAULT_DIFFICULTY = "ì¤‘"
DEFAULT_DURATION = 30

# ChromaDB
CHROMA_PERSIST_DIR = "./chroma_data"
CHROMA_COLLECTION_NAME = "health_summaries"

# CORS
ALLOWED_ORIGINS = os.getenv("ALLOWED_ORIGINS", "http://localhost:3000").split(",")
```

### .env (ì˜ˆì‹œ)

```env
OPENAI_API_KEY=sk-xxx
LLM_MODEL=gpt-4o-mini
LLM_TEMPERATURE=0.3
LLM_MAX_TOKENS=2048
ALLOWED_ORIGINS=http://localhost:3000,http://192.168.0.15:3000
```

---

## ğŸš€ ì„œë²„ ì‹¤í–‰

```bash
# ê°œë°œ ëª¨ë“œ
uvicorn main:app --reload --host 0.0.0.0 --port 8000

# í”„ë¡œë•ì…˜ ëª¨ë“œ
uvicorn main:app --host 0.0.0.0 --port 8000 --workers 4
```

---

## ğŸ“Š ì˜ì¡´ì„± êµ¬ì¡°

```
main.py
â”œâ”€â”€ config.py
â”œâ”€â”€ app/api/
â”‚   â”œâ”€â”€ file_upload_api.py â”€â”€â–º file_upload_service.py
â”‚   â”œâ”€â”€ auto_upload_api.py â”€â”€â–º auto_upload_service.py
â”‚   â”œâ”€â”€ chat_api.py â”€â”€â–º chat_service.py
â”‚   â”œâ”€â”€ user_api.py â”€â”€â–º vector_store.py, llm_analysis.py
â”‚   â””â”€â”€ similar_api.py â”€â”€â–º similar_service.py
â”‚
â”œâ”€â”€ app/service/
â”‚   â”œâ”€â”€ file_upload_service.py â”€â”€â–º unzipper, db_to_json, db_parser,
â”‚   â”‚                              preprocess, vector_store, llm_analysis
â”‚   â”œâ”€â”€ auto_upload_service.py â”€â”€â–º preprocess, vector_store, llm_analysis
â”‚   â”œâ”€â”€ chat_service.py â”€â”€â–º chat_generator, fixed_responses
â”‚   â””â”€â”€ similar_service.py â”€â”€â–º vector_store
â”‚
â”œâ”€â”€ app/core/
â”‚   â”œâ”€â”€ health_interpreter.py (ë…ë¦½)
â”‚   â”œâ”€â”€ llm_analysis.py â”€â”€â–º health_interpreter, vector_store, rag_query
â”‚   â”œâ”€â”€ vector_store.py â”€â”€â–º chromadb, openai
â”‚   â”œâ”€â”€ rag_query.py (ë…ë¦½)
â”‚   â”œâ”€â”€ db_parser.py (ë…ë¦½)
â”‚   â”œâ”€â”€ db_to_json.py (ë…ë¦½)
â”‚   â”œâ”€â”€ unzipper.py (ë…ë¦½)
â”‚   â””â”€â”€ chatbot_engine/
â”‚       â”œâ”€â”€ chat_generator.py â”€â”€â–º intent_classifier, persona, rag_query
â”‚       â”œâ”€â”€ fixed_responses.py â”€â”€â–º persona, vector_store, llm_analysis
â”‚       â”œâ”€â”€ intent_classifier.py (ë…ë¦½)
â”‚       â”œâ”€â”€ persona.py (ë…ë¦½)
â”‚       â””â”€â”€ rag_query.py â”€â”€â–º vector_store
â”‚
â””â”€â”€ app/utils/
    â”œâ”€â”€ preprocess.py (ë…ë¦½)
    â”œâ”€â”€ preprocess_for_embedding.py (ë…ë¦½)
    â””â”€â”€ platform_detection.py (ë…ë¦½)
```
